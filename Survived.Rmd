---
title: "中文測試Survived or not"
date: '`r Sys.Date()`'
output:
  html_document:
    number_sections: true
    fig_caption: true
    toc: true
    fig_width: 7
    fig_height: 4.5
    theme: cosmo
    highlight: tango
    code_folding: hide
---

```{r setup, include=FALSE, echo=FALSE}
knitr::opts_chunk$set(echo=TRUE, error=FALSE)
```

# Introduction 中文測試

This is an initial Exploratory Data Analysis for the [Titanic: Machine Learning from Disaster](https://www.kaggle.com/c/titanic) with [tidy R](http://tidyverse.org/) and [ggplot2](http://ggplot2.tidyverse.org/).

## Load libraries and load data. 中文測試

`train.csv` and `test.csv` are [here](https://www.kaggle.com/c/titanic/data).

```{r, message = FALSE}
# general visualisation
library('ggplot2') # visualisation
library('scales') # visualisation
library('grid') # visualisation
library('gridExtra') # visualisation
library('RColorBrewer') # visualisation
library('corrplot') # visualisation
library("cowplot") # visualisation
library("ggpubr")

# general data manipulation
library('dplyr') # data manipulation
library('readr') # input/output
library('data.table') # data manipulation
library('tibble') # data wrangling
library('tidyr') # data wrangling
library('stringr') # string manipulation
library('forcats') # factor manipulation
library("knitr") # data table

# Dates
library('lubridate') # date and time

# Extra vis
library('ggforce') # visualisation
library('ggridges') # visualisation

train <- fread("train.csv");
test <- fread("test.csv");
```

## Data structure

- Train

```{r}
summary(train)
```



```{r, tidy=TRUE}
glimpse(train)
```

- Test

```{r}
summary(test)
```



```{r}
glimpse(test)
```

## Missing values

- Train missing

```{r}
sum(is.na(train))

```

- Test missing

```{r}
sum(is.na(test))
```

## Reformating variable.

- Ignore missing data temporarily.

- Survived reformate by as.factor and ignore PassengerId.

- Pclass, Sex and Embarked reformate by as.factor.

- Age, SibSp, Parch, Fare reformate by as.numeric.

- Name 
 
 + Remove punctuations of Name.
 
 + Find Mr, Miss, Mrs, William, Master, John, Henry frequency is higher.

 + 

```{r}
train$Name %>% 
  strsplit(" ") %>% 
  unlist(use.names = F) %>% 
  table(dnn = "Word freq") %>% 
  sort() %>% tail(27)
```


- Select the first word from Ticket.

- Cabin too many unknown, not good feature for survived.

```{r}
train <-
  train %>%
  na.omit %>%
  mutate(Survived = as.factor(Survived),
         Pclass = as.factor(Pclass),
         Sex = as.factor(Sex),
         Embarked = as.factor(Embarked),
         Age = as.numeric(Age),
         SibSp = as.numeric(SibSp),
         Parch = as.numeric(Parch),
         Fare = as.numeric(Fare)
         );
##  Reformate Name
train <- train %>%
  mutate(Name = gsub("[.,]", "", Name)) %>%
  mutate(Name = gsub("[[:punct:]]", "", Name));
##  Reformate Ticket
train <- train %>% 
  mutate(Ticket = gsub("[. ]", "", Ticket)) %>%
  mutate(Ticket = gsub("[[:punct:]]", "", Ticket)) %>%
  mutate(Ticket = substr(Ticket, start=1, stop = 1)) %>%
  mutate(Ticket = as.factor(Ticket));

test <-
  test %>%
  na.omit %>%
  mutate(Pclass = as.factor(Pclass),
         Sex = as.factor(Sex),
         Embarked = as.factor(Embarked),
         Age = as.numeric(Age),
         SibSp = as.numeric(SibSp),
         Parch = as.numeric(Parch),
         Fare = as.numeric(Fare)
         );
##  Reformate Name
test <- test %>%
  mutate(Name = gsub("[.,]", "", Name)) %>%
  mutate(Name = gsub("[[:punct:]]", "", Name));
##  Reformate Ticket
test <- test %>% 
  mutate(Ticket = gsub("[. ]", "", Ticket)) %>%
  mutate(Ticket = gsub("[[:punct:]]", "", Ticket)) %>%
  mutate(Ticket = substr(Ticket, start=1, stop = 1)) %>%
  mutate(Ticket = as.factor(Ticket));
```

# Target

- Survived is less than died.

- The most people died from 3class.

```{r}
p11 <- train %>%
  ggplot(aes(Survived, fill = Survived)) +
  geom_bar(fill = "blue") +
  theme(legend.position = "none") + theme_minimal();
p12 <- train %>% 
  ggplot(aes(x = Survived, fill = Pclass)) +
  geom_bar() + theme_minimal()
figure11 <- ggarrange(p11, p12, ncol = 2, nrow = 1);
annotate_figure(figure11);
```

- Female survived more than man.

- C survived people is the most.

```{r}
p13 <- train %>% 
  ggplot(aes(x = Survived, fill = Sex)) +
  geom_bar() + theme_minimal();
p14 <- train %>% 
  ggplot(aes(x = Survived, fill = Embarked)) +
  geom_bar() + theme_minimal();
figure12 <- ggarrange(p13, p14, ncol = 2, nrow = 1);
annotate_figure(figure12);
```

- SibSp is 1, survived more than died.

- Parch is 1 and 2, survived more than died.

```{r}
p15 <- train %>% 
  ggplot(aes(x = Survived, fill = as.factor(SibSp))) +
  geom_bar() + theme_minimal() + labs(fill = "SibSp");
p16 <- train %>% 
  ggplot(aes(x = Survived, fill = as.factor(Parch))) +
  geom_bar() + theme_minimal() + labs(fill = "Parch");
figure13 <- ggarrange(p15, p16, ncol = 2, nrow = 1);
annotate_figure(figure13);
```

- More young childs are survived.

- More fare, more survived.

```{r}
p17 <- train %>%
  ggplot(aes(x = Age, colour = Survived)) + geom_density() +
  theme(legend.position = "none");
p18 <- train %>%
  ggplot(aes(x = Fare, colour = Survived)) + geom_density() +
  facet_zoom(x = Fare<100);
figure14 <- ggarrange(p17, p18, ncol = 2, nrow = 1);
annotate_figure(figure14);
```

- Ticket is 3, a lot of people died.

```{r}
# train %>% ggplot(aes(x = Survived, fill = Ticket)) + 
#   geom_bar(width = 0.9, position=position_dodge());
#   
# wordcount <- train %>% 
#   select(Name) %>% 
#   lapply(function(x) strsplit(x," ")) %>%
#   unlist(use.names = F) %>% 
#   table %>% 
#   data.frame;
# colnames(wordcount) <- c("Word","Freq");
# subset(wordcount, Freq>10) %>% 
#   ggplot(aes(Word, Freq)) +
#   geom_bar(stat="identity", fill="darkred", colour="darkgreen") +
#   theme(axis.text.x=element_text(angle=45, hjust=1)) + 
#   labs(title = "Train");
# # figure15 <- ggarrange(p19, p110, ncol = 2, nrow = 1);
# # annotate_figure(figure15);
```














# Individual variable visualisations

## Pclass

- 3class is the most people.

```{r}
p21 <- train %>%
  ggplot(aes(Pclass, fill = Pclass)) +
  geom_bar() +
  theme(legend.position = "none") +
  labs(title = "Tain");
p22 <- test %>%
  ggplot(aes(Pclass, fill = Pclass)) +
  geom_bar() +
  theme(legend.position = "none") + 
  labs(title = "Test");
figure2 <- ggarrange(p21, p22, ncol = 2, nrow = 1);
annotate_figure(
  figure2,
  top = text_grob("Pclass", color = "red", face = "bold", size = 14)
);
```

## Embarked

- Embarked from S is the most.

- Train have a few people that I don't known where they embarked.

```{r}
p31 <- train %>%
  ggplot(aes(Embarked, fill = Embarked)) +
  geom_bar() +
  theme(legend.position = "none") + 
  labs(title = "Tain");
p32 <- test %>%
  ggplot(aes(Embarked, fill = Embarked)) +
  geom_bar() +
  theme(legend.position = "none") + 
  labs(title = "Test");
figure3 <- ggarrange(p31, p32, ncol = 2, nrow = 1);
annotate_figure(
  figure3,
  top = text_grob("Embarked", color = "red", face = "bold", size = 14)
);
```

## Sex

- Male is more than female.

```{r}
p41 <- train %>%
  ggplot(aes(Sex, fill = Sex)) +
  geom_bar() +
  theme(legend.position = "none") +
  labs(title = "Train");
p42 <- test %>%
  ggplot(aes(Sex, fill = Sex)) +
  geom_bar() +
  theme(legend.position = "none") +
  labs(title = "Test");
figure4 <- ggarrange(p41, p42,
                     ncol = 2, nrow = 1);
annotate_figure(
  figure4,
  top = text_grob("Sex", color = "red", face = "bold", size = 14)
);
```

## SibSp.

- Numeric type, but not more.

- Most people have 0 or 1.

```{r}
p51 <- train %>%
  ggplot(aes(SibSp, fill = SibSp)) +
  geom_bar(fill = "blue") +
  theme(legend.position = "none") + 
  labs(title = "Train");
p52 <- test %>%
  ggplot(aes(SibSp, fill = SibSp)) +
  geom_bar(fill = "blue") +
  theme(legend.position = "none") + 
  labs(title = "Test");
figure5 <- ggarrange(p51, p52,
                     ncol = 2, nrow = 1);
annotate_figure(figure5,
                top = text_grob("SibSp", color = "red", face = "bold", size = 14));
```

## Parch

- Numeric type, but not more.

- Most people have 0 or 1.

```{r}
p61 <- train %>%
  ggplot(aes(Parch, fill = Parch)) +
  geom_bar(fill = "blue") +
  theme(legend.position = "none") + 
  labs(title = "Train");
p62 <- test %>%
  ggplot(aes(Parch, fill = Parch)) +
  geom_bar(fill = "blue") +
  theme(legend.position = "none") + 
  labs(title = "Test");
figure6 <- ggarrange(p61,p62,
                     ncol = 2, nrow = 1);
annotate_figure(figure6,
                top = text_grob("Parch", color = "red", face = "bold", size = 14));
```

## Age

- There are some childs.

```{r}
p71 <- train %>%
  ggplot(aes(Age)) +
  geom_density(fill = "yellow", bw = 0.6) + 
  labs(title = "Train");
p72 <- test %>%
  ggplot(aes(Age)) +
  geom_density(fill = "yellow", bw = 0.6) + 
  labs(title = "Test");
figure7 <- ggarrange(p71,p72,ncol = 2, nrow = 1);
annotate_figure(figure7,
                top = text_grob("Age", color = "red", face = "bold", size = 14));
```

## Fare

- The most fare is on [0,25].

```{r}
p81 <- train %>%
  ggplot(aes(Fare)) +
  geom_density(fill = "green", bw = 0.6) +
  facet_zoom(x = (Fare)<100) + 
  labs(title = "Train");
p82 <- test %>%
  ggplot(aes(Fare)) +
  geom_density(fill = "green", bw = 0.6) +
  facet_zoom(x = (Fare)<100) + 
  labs(title = "Test");
figure8 <- ggarrange(p81, p82, ncol = 2, nrow = 1);
annotate_figure(figure8,
                top = text_grob("Fare", color = "red", face = "bold", size = 14));
```

## Name

- There are some words frequency are high, like Mr, Mrs and Miss.

```{r}
wordcount <- train %>% 
  select(Name) %>% 
  lapply(function(x) strsplit(x," ")) %>%
  unlist(use.names = F) %>% 
  table %>% 
  data.frame;
colnames(wordcount) <- c("Word","Freq");
p91 <- subset(wordcount, Freq>10) %>% 
  ggplot(aes(Word, Freq)) +
  geom_bar(stat="identity", fill="darkred", colour="darkgreen") +
  theme(axis.text.x=element_text(angle=45, hjust=1)) + 
  labs(title = "Train");
wordcount <- test %>% 
  select(Name) %>% 
  lapply(function(x) strsplit(x," ")) %>%
  unlist(use.names = F) %>% 
  table %>% 
  data.frame;
colnames(wordcount) <- c("Word","Freq");
p92 <- subset(wordcount, Freq>10) %>% 
  ggplot(aes(Word, Freq)) +
  geom_bar(stat="identity", fill="darkred", colour="darkgreen") +
  theme(axis.text.x=element_text(angle=45, hjust=1)) + 
  labs(title = "Test");
figure9 <- ggarrange(p91, p92, ncol = 1, nrow = 2);
annotate_figure(figure9,
                top = text_grob("Name", color = "red", face = "bold", size = 14));
```

## Ticket

- Ticket with the first word, I find 1, 2, 3 are the most and A, C, P, S have many.

```{r}
p101 <- train %>%
  ggplot(aes(Ticket)) + geom_bar(fill = "red") +
  labs(title = "Train");
p102 <- test %>%
  ggplot(aes(Ticket)) + geom_bar(fill = "red") +
  labs(title = "Test");
figure10 <- ggarrange(p101, p102, ncol = 1, nrow = 2);
annotate_figure(figure10,
                top = text_grob("Ticket", color = "red", face = "bold", size = 14));
```

---


































