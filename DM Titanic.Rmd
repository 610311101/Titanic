---
title: 'Data Mining: Titanic, Survived vs others.'
output:
  html_document: default
  html_notebook: default
---
```{r, message=FALSE, warning=FALSE}
library("caret");
library("ggplot2");
library("magrittr");
library("plot3D");
library("dplyr");
# Multiple plot function
#
# ggplot objects can be passed in ..., or to plotlist (as a list of ggplot objects)
# - cols:   Number of columns in layout
# - layout: A matrix specifying the layout. If present, 'cols' is ignored.
#
# If the layout is something like matrix(c(1,2,3,3), nrow=2, byrow=TRUE),
# then plot 1 will go in the upper left, 2 will go in the upper right, and
# 3 will go all the way across the bottom.
#
multiplot <- function(..., plotlist=NULL, file, cols=1, layout=NULL) {
  library(grid)

  # Make a list from the ... arguments and plotlist
  plots <- c(list(...), plotlist)

  numPlots = length(plots)

  # If layout is NULL, then use 'cols' to determine layout
  if (is.null(layout)) {
    # Make the panel
    # ncol: Number of columns of plots
    # nrow: Number of rows needed, calculated from # of cols
    layout <- matrix(seq(1, cols * ceiling(numPlots/cols)),
                    ncol = cols, nrow = ceiling(numPlots/cols))
  }

 if (numPlots==1) {
    print(plots[[1]])

  } else {
    # Set up the page
    grid.newpage()
    pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))

    # Make each plot, in the correct location
    for (i in 1:numPlots) {
      # Get the i,j matrix positions of the regions that contain this subplot
      matchidx <- as.data.frame(which(layout == i, arr.ind = TRUE))

      print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row,
                                      layout.pos.col = matchidx$col))
    }
  }
}
```
```{r}
set.seed(1);
df          <- read.csv("train.csv");
df$Survived <- as.factor(df$Survived);
intrain <- createDataPartition(
  y = df$Survived,  ##  0 is dead, 1 is survived.
  p = 0.75,
  list = FALSE
);
train <- df[intrain,];
str(train)
```
In Titanic data, is classification problem,
Y is "Survived", 0 means dead, 1 means life,
dimension of variable X is 11.

-----------
### In "Pclass" and "Survived"  
 1. Rate of dead is higher if Ticket class of people is 3.  
 2. Rate of dead is half if Ticket class of people is 2.  
 3. Rate of survived is higher if Ticket class of people is 1.

I guess Ticket class 1 is VIP.
```{r, echo=FALSE}
z <- table( "Pclass" = train$Pclass, "Survived" =train$Survived );
par(mfrow = c(1,2))
hist3D(z=z, border="black", xlab = "Pclass", ylab = "Survived", zlab = "counts")
image2D(z=z, border="black", xlab = "Pclass", ylab = "Survived", axes=F)
axis(2, at = c(0,1), label = c("0","1"))
axis(1, at = c(0,0.5,1), label = c("1","2","3"))
mtext("Pclass vs Survived", side = 3, line = -21, outer = TRUE)
apply(z, 2, function(x) x/rowSums(z))
```
### In "Sex" and "Survived"  
 1. Rate of dead is higher if male.  
 2. Rate of survived is higher if female.

Gentlemen.
```{r, echo=FALSE}
z <- table( "Sex" = train$Sex, "Survived" = train$Survived )
par(mfrow = c(1,2))
hist3D(z=z, border="black", xlab = "Sex", ylab = "Survived", zlab = "counts")
image2D(z=z, border="black", xlab = "Sex", ylab = "Survived", axes=F)
axis(2, at = c(0,1), label = c("0","1"))
axis(1, at = c(0,1), label = c("female","male"))
mtext("Sex vs Survived", side = 3, line = -21, outer = TRUE)
apply(z, 2, function(x) x/rowSums(z))
```
### In "Age" and "Survived"  
 1. There are missing data in "Age".  
 2. I found the rate of dead is
    lower if age less than 10 only.
```{r, echo=FALSE}
age <- rbind(
  train[!is.na(train$Age),] %>% select(Age, Survived) %>% filter(Survived==0),
  train[!is.na(train$Age),] %>% select(Age, Survived) %>% filter(Survived==1)
)

ggplot(age, aes(x = Age, color=Survived)) +
  geom_density()
```
### In "SibSp" and "Survived"
"SibSp" means brothers and sisters.  
 1. 465 people not have brothers and sisters.  
 2. 6 people have 8 "SibSp".  
```{r, echo=FALSE}
table(train$SibSp, dnn = "SibSp"); 
```
 3. "SibSp" over 5 almost dead.
 4. Rate of dead < 50% if have 2 "SibSp".
```{r, echo=FALSE}
z <- table( "SibSp" = train$SibSp, "Survived" = train$Survived )
cbind(
  z,
  apply(z, 2, function(x) x/rowSums(z)) %>% round(digits = 3)
) 
```
### In "Parch" and "Survived"
"Parch" means parents and children.  
 1. There are 523 people that have no parents and children.
```{r, echo=FALSE}
table("Parch" =train$Parch);
```
 2. Rate of dead < 50%, if have 1 or 2, parents and children.
```{r, echo=FALSE}
z <- table( "Parch" = train$Parch, "Survived" = train$Survived )
cbind(
  z,
  apply(z, 2, function(x) x/rowSums(z)) %>% round(digits = 3)
) 
```
### In "Fare" and "Survived"
"Fare" means passenger fare, no missing data.

 1. "Fare" is numeric and have 223 types.
```{r, echo=FALSE}
(train$Fare) %>% summary()
```
 2. High rate of people dead if "Fare" is some vlaues.
 3. If "Fare" higher, then you probably survive.
```{r, echo=FALSE}
fare <- rbind(
  train[!is.na(train$Fare),] %>% select(Fare, Survived) %>% filter(Survived==0),
  train[!is.na(train$Fare),] %>% select(Fare, Survived) %>% filter(Survived==1)
)
par(mfrow=c(1,2))
p1 <- ggplot(fare, aes(x = Fare, color=Survived)) +
  geom_density()
p2 <- ggplot(fare, aes(x=Survived, y=Fare, color = Survived)) + 
  geom_boxplot(notch=F)
multiplot(p1,p2)
```
### In "Embarked" and "Survived"
Embarked" means port of embarkation, there two people I don't know where they embark.
```{r, echo=FALSE}
table("Embarked" = train$Embarked)
```
 1. That 2 people all survive.
 2. Many people from port C.
 3. Rate of dead from Q and S is similar.
 4. Rate of survive from C is over 50%. 
```{r, echo=FALSE}
z <- train %>% select(Embarked,Survived) %>% table();
cbind(z,apply(z, 1, function(x) x/sum(x)) %>% t() %>% round(digits = 4))
```


